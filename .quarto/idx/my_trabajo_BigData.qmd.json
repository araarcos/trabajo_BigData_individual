{"title":"MCU. Un análisis codificado","markdown":{"yaml":{"title":"MCU. Un análisis codificado","description":"Un recorrido por las películas y los personajes del Universo Cinematográfico de Marvel\n","author":[{"name":"Arantxa Anais Arcos Raimundo","affiliation":"Universitat de València","affiliation-url":"https://www.uv.es"}],"date":"2026-01-02","categories":["trabajo BigData","marvel","hérores","películas"],"image":"./imagenes/universo_marvel.jpg","title-block-banner":true,"title-block-banner-color":"EB1F48","toc-depth":3,"smooth-scroll":true,"format":{"html":{"link-external-newwindow":true}},"code-tools":true,"code-link":true},"headingText":"Motivación","containsRefs":false,"markdown":"\n\n\nEl Universo Cinematográfico de Marvel ha cambiado la industria del cine al popularizar el concepto de *multiverso* y *universo compartido*. No se trata solo de películas individuales, sino de una red interconectada de historias donde las acciones de una película afectan a las demás y todas estas están relacionadas.\n\nAsí pues, se ha convertido en una de las franquicias cinematográficas más taquillera de la historia, demostrando cómo una saga a largo plazo como lo es la *Saga del infinito* puede mantener el interés del público durante más de una década.\n\nPor ello, el trabajo presente tiene el objetivo de entender y averiguar las distintas características de las películas y personajes de Marvel desde la perspectiva de una fan. \n\n*Así que vamos allá!!*\n\n## Historia del MCU\n\nEn primer lugar, debemos saber que el UCM es una franquicia de medios centrada en una serie de películas de superhéroes producidas por Marvel Studios, basada en los personajes de Marvel Comics. La saga se divide en fases con dos arcos grandes: la Saga del Infinito y la Saga del Multiverso.\n\nNos centramos en sobre todo en la *Saga del Infinito* ya que es dónde se encuentra el grupo de *Avengers* el cual estaremos analizando durante todo el trabajo. Cabe mencionar que la película que pone final a la lucha de los vengadores está en la fase tres y es *Avengers: Endgame* (2019).\n\nPor otro lado, la primera película fue *Iron Man* en 2008 y fue dirigida por Jon Favreau. Esta película tiene mucha relevancia ya que fue el inicio de la presentación de héores individuales para posteriormente dar lugar a los Vengadores.\n\nAsí pues, en relación con *The Avengers* estos se reunen por primera vez en 2012, año de estreno de la película. El grupo original está formado por:\n\n- Iron Man.\n- Captain America.\n- Thor.\n- Hulk.\n- Black Widow.\n- Hawkeye.\n\nSin embargo, cabe mencionar que los personajes aparecidos en la última batalla y que, por tanto, vamos a considerar Vengadores y son los que vamos a analizar son los siguientes:\n\n- Trinidad de Vengadores: Iron Man, Capitán América y Thor.\n\n- Líderes de apoyo: Hulk, Hawkeye, War Machine, Ant-Man, Rocket y Nebula.\n\n- Héroes regresados por portales: Spider-Man, Black Panther, Shuri, Okoye, Falcon, Winter Soldier, Scarlet Witch, Doctor Strange, Wong y Wasp.\n\n- Guardianes de la Galaxia: Star-Lord, Drax, Mantis, Groot y Gamora (2014).\n\n- Refuerzos clave: Capitana Marvel, Valkyrie, Korg, Miek y Rescue (Pepper Potts).\n\n- Ejércitos aliados: Las Dora Milaje de Wakanda, los Hechiceros de las Artes Místicas, el ejército de Asgard y los Saqueadores.\n\n- Especial mención a Black Widow.\n\n## Introducción\n\nVamos a utilizar datos extraídos de Kaggle, los cuales podemos encontrar [aquí](https://www.kaggle.com/datasets/jainaru/marvel-movies-box-office-data?resource=download),  [aquí](https://www.kaggle.com/datasets/sahirmaharajj/the-avengers-dataset/data), \n[aquí](https://www.kaggle.com/datasets/dalepeh/mcu-movies-dataset) y\n[aquí](https://www.kaggle.com/datasets/jonbown/marvel-screen-time),\n\n\nA continuación, explicaremos un poco nuestra elección de datos:\n\nPor un lado, encontramos dfs en los que solo tenemos las películas del MCU y sus distintas variables con las que realizaremos el trabajo como son: las fases, la recaudación, las valoraciones, los años de estreno, los directores ... Además, tenemos un df con la duración en minutos de las películas.\n\nPor otro lado, hemos cargado dfs con los personajes tanto del MCU como de los cómics para poder trabajar con el global y solo con los Vengadores.\n\nLos datos se pueden cargar en la memoria de de R/RStudio de esta forma:\n\n```{r}\n#Importación de películas\n\nmy_ruta <- \"./data/marvel_movies.csv\"\n\ndf_movies <- rio::import(my_ruta)\n\nnames (df_movies)\n\nmy_ruta_fases <- \"./data/box_office.csv\"\n\ndf_fases <- rio::import(my_ruta_fases)\n\nmy_ruta_duracion <- \"./data/movie_times.csv\"\n\ndf_duracion <- rio::import(my_ruta_duracion)\n\n#- A continuación, para obtener los datos sobre los personajes podemos hacerlo de dos formas:\n\nmy_ruta_personajes <- \"./data/avengers.csv\" #- En este caso, creamos ruta relativa e importamos\n\ndf_personajes <- rio::import(my_ruta_personajes)\n\n#install.packages(\"fivethirtyeight\") ---- En este otro, instalamos el paquete que contiene a los personajes \n#library(fivethirtyeight)\n#df_personajes <- avengers ---- asociamos el nombre que queremos.install.packages(\"fivethirtyeight\")\n\nmy_ruta_fases <- \"./data/box_office.csv\"\n\ndf_fases <- rio::import(my_ruta_fases)\n\nmy_ruta_total_personajes <- \"./data/marvel_wikia_data.csv\"\n\ndf_total_personajes <- rio::import(my_ruta_total_personajes)\n\n```\n\nEl primer dataset contiene observaciones sobre un conjunto de `r nrow(df_movies)` películas de Marvel. Hay `r ncol(df_movies)` variables. El segundo dataset contiente observaciones sobre un conjunto `r nrow(df_personajes)` personajes de cómics. Hay `r ncol(df_personajes)` variables. \n\nCabe destacar que los datasets escogidos solo llegan hasta 2023 por lo que el análisis no incluirá los cambios que han habido de vengadores o algunas de las nuevas incorporaciones más recientes ni tendrá todas las películas de la fase 5 ni 6 (actual).\n\n---\n\n## Marvel Studios\n\nA continuación, podemos observar una imagen en la que se encuentran muchos de los principales personajes del Universo Cinematográfico de Marvel.\n\n```{r}\n#| echo: false\nmy_url <- \"https://images.alphacoders.com/100/1003204.jpg\"\n```\n\n![Marvel](https://images.alphacoders.com/100/1003204.jpg)\n\n```{r}\n#| echo: false\nlibrary(tidyverse)\nlibrary(ggimage)\nlibrary(magick)\n#| label: animacion-heroes\n#| message: false\n#| warning: false\n\niron_man <- image_read(\"./imagenes/iron_man.jpg\") %>% image_scale(\"700\")\nthor <- image_read(\"./imagenes/thor.webp\") %>% image_scale(\"700\")\nblack_panther <- image_read(\"./imagenes/black_panther.jpg\") %>% image_scale(\"700\")\nhawkeye <- image_read(\"./imagenes/hawkeye.jpg\") %>% image_scale(\"700\")\nblack_widow <- image_read(\"./imagenes/black_widow.jpg\") %>% image_scale(\"700\")\nspiderman <- image_read(\"./imagenes/spiderman.jpg\") %>% image_scale(\"700\")\ncaptain_america <- image_read(\"./imagenes/capi.jpg\") %>% image_scale(\"700\")\nhulk <- image_read(\"./imagenes/hulk.jpg\") %>% image_scale(\"700\")\ndr_strange <- image_read(\"./imagenes/dr_strange.jpg\") %>% image_scale(\"700\")\nguardianes <- image_read(\"./imagenes/guardianes.webp\") %>% image_scale(\"700\")\n\nheroes <- c(iron_man, thor, black_panther, hawkeye, black_widow, spiderman, captain_america, hulk, dr_strange, guardianes)\n\nanimacion <- image_animate(heroes, fps = 0.5)\nanimacion\n```\n\n------------------------------------------------------------------------\n\nComo bien sabemos el MCU es mucho más extenso ya que en los cómics hay muchos más personajes de los que han llegado a salir en la saga de *Avengers*; por ello, en el margen vamos a poner una foto con muchos más héroes y heroínas:\n\n::: column-margin\n![](./imagenes/universo_marvel.jpg){fig-align=\"center\"}\n:::\n\n------------------------------------------------------------------------\n\n\n\n## Algunos gráficos\n\nBueno pues vamos a hacer algún gráfico, pero claro antes he de cargar los paquetes.\n\n```{r}\n#| eval: true\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(forcats)\nlibrary(gt)\nlibrary(plotly)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary (treemap) #install.packages (\"treemap\")\nlibrary(ggimage)\n\n```\n\nPor otro lado, vamos a establecer la paleta que pondremos en nuestros gráficos.\n\n```{r setup}\n#Configuración de paleta\n\nlibrary(paletteer)\n\npaleta_discreta <- paletteer_c( \"ggthemes::Orange-Blue-White Diverging\", 6)\n\nscale_fill_default <- function(...) {\n  scale_fill_gradientn(colors = mi_paleta, ...)\n}\n\nscale_color_default <- function(...) {\n  scale_color_gradientn(colors = mi_paleta, ...)\n}\n\n\n```\n\n\nUn paso previo también es arreglar los datos. Para ello, en primer lugar, vamos a quitar aquellas columnas que no necesitamos o añadir las que nos hagan falta.\n\n```{r}\n#- En el df de películas no vamos a quitar ninguna columna; sin embargo, vamos a añadir una con el protagonista de cada película.\ndf_movies <- df_movies %>%\n  mutate (protagonista = case_when(\n    grepl(\"Iron\", movie) ~ \"Iron Man\",\n    grepl(\"America\", movie) ~ \"Captain America\",\n    grepl(\"Thor\", movie) ~ \"Thor\",\n    grepl(\"Incredible Hulk\", movie) ~ \"Hulk\",\n    grepl(\"Widow\", movie) ~ \"Black Widow\",\n    grepl(\"Ant-Man\", movie) ~ \"Ant-Man\",\n    grepl(\"Spider-Man\", movie) ~ \"Spider-Man\",\n    grepl(\"Shang-Chi\", movie) ~ \"Shang-Chi\",\n    grepl(\"Deadpool\", movie) ~ \"Deadpool\",\n    grepl(\"Panther\", movie) ~ \"Black Panther\",\n    grepl(\"Strange\", movie) ~ \"Dr Strange\",\n  )) %>%\n  relocate (protagonista, .after = category)\n\n#- En este caso, vamos a juntar el df de duración con el dde fases; para ello, primeramente tenemos que cambiar algunos nombres de películas porque la forma en la que están escritos es diferente en cada df y no podemos juntarlos bien.\ndf_duracion <- df_duracion %>%\n  mutate(movie = case_when(\n    movie == \"Spider-Man: Far from Home\" ~ \"Spider-Man: Far From Home\",\n    movie == \"Shang-Chi\" ~ \"Shang-Chi and the Legend of the Ten Rings\",\n    TRUE ~ movie))\n  \ndf_fases <- df_fases %>%\n  select (Phase, Film, Year_Release, Director, movie_image) %>%\n  left_join (df_duracion, by = c(\"Film\" = \"movie\"))  #- Tener en cuenta que en df_duración solo hasta 2021, aparecerán 5 NAs.\n\n#- Por otra parte, en el df de personajes vamos a hacer algunas modificaciones. Comenzaremos quitando estas dos columnas que no nos hacen falta:\ndf_personajes <- df_personajes %>%\n  select (- V22, - Notes)\n\n#- A continuación, añadimos una nueva columna llamada \"Alias\" en las que pondremos los nombres de superhéroe de cada personaje y la recolocaremos al lado de los Nombres/Alias originales:\n\ndf_personajes <- df_personajes %>%\n  filter(`Name/Alias` != \"Tony Masters\") %>% \n  mutate(Alias = case_when(\n    grepl(\"Tony\", `Name/Alias`) ~ \"Iron Man\",\n    grepl(\"Clinton Francis Barton\", `Name/Alias`) ~ \"Hawkeye\",\n    grepl(\"Rogers\", `Name/Alias`) ~ \"Captain America\",\n    grepl(\"Thor\", `Name/Alias`) ~ \"Thor\",\n    grepl(\"Banner\", `Name/Alias`) ~ \"Hulk\",\n    grepl(\"Romanova\", `Name/Alias`) ~ \"Black Widow\",\n    grepl(\"Scott Edward Harris Lang\", `Name/Alias`) ~ \"Ant-Man\",\n    grepl(\"Wanda Maximoff\", `Name/Alias`) ~ \"Scarlet Witch\",\n    grepl(\"Peter Benjamin Parker\", `Name/Alias`) ~ \"Spider-Man\",\n    grepl(\"Shang-Chi\", `Name/Alias`) ~ \"Shang-Chi\",\n    grepl(\"T'Challa\", `Name/Alias`) ~ \"Black Panther\",\n    grepl(\"Buchanan\", `Name/Alias`) ~ \"Bucky\",\n    grepl(\"Victor Shade \", `Name/Alias`) ~ \"Vision\",\n    grepl(\"Doctor Stephen Vincent Strange\", `Name/Alias`) ~ \"Dr Strange\",\n    TRUE ~ \"Other\")) %>%\n  relocate(Alias, .after = `Name/Alias`)\n\n#- También vamos a crear un nuevo df con los Vengadores para poder juntarlos con el df_movies\n\navengers <- df_personajes %>%\n  filter (Alias != \"Other\") %>%\n  select (URL, `Name/Alias`, Alias, Appearances, Gender)\n\n#- Finalmente, juntaremos el df de avengers con el de películas para tener observar las películas individuales que tienen algunos personajes:\n\npelicula_propia <- avengers %>%\n  left_join(df_movies, by = c(\"Alias\" = \"protagonista\")) %>%\n  select (`Name/Alias`,movie, Gender, Appearances, Alias, year)\n\n#- Finalmente, los df que usaremos son los siguientes:\n#- df_fases\n#- pelicula_propia\n#- df_movies\n#- df_total_personajes\n\n```\n\n------------------------------------------------------------------------\n\n### Primeros gráficos. Comparativa numérica\n\nEn este apartado, realizamos una comparación entre el número de héroes y heroínas y la cantidad de películas que están asociadas a cada uno.\n\nEn este primer gráfico, vamos a contrastar el número de personajes que hay en el MCU según su género para mostrar en una gráfica que el número de hombres es mayor al de mujeres, debido a que en un comienzo la mayoría de personajes que se escribían eran hombres.\n\n```{r}\n#- primer gráfico\n\nsexo <- df_total_personajes %>% \n  filter(SEX %in% c(\"Male Characters\", \"Female Characters\"))\n\np <- ggplot(data = sexo,\n  mapping = aes(x = SEX, fill = SEX)) +\n  geom_bar() +\n  labs(\n    title = \"Comparativa de sexo entre superhéroes\",\n    x = \"Sexo\",\n    y = \"Número de superhéroes\") +\n  theme_minimal(base_family = \"mono\") +\n  theme(legend.position = \"none\",\n        plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) +  \n  scale_fill_manual(values = paleta_discreta)\n\np\n\n\n```\n\nTras esta imagen, vamos a comparar el porcentaje de películas individuales que tienen los hombres vs las mujeres dentro del equipo de Vengadores en un piechart. Como podemos comprobar, al haber más héroes, tanto en el equipo de Avengers como en general, el porcentaje de películas que van a estar protagonizadas por ellos es mucho mayor.\n\n```{r}\n\nporcentaje <- pelicula_propia %>%\n  filter(!is.na(movie)) %>%\n  count(Gender) %>%\n  mutate(\n    porcentaje = n / sum(n),\n    label = scales::percent(porcentaje, accuracy = 1))\n\np <- ggplot( porcentaje,\n  aes(x = \"\", y = n, fill = Gender)) +\n  geom_bar(stat = \"identity\", width = 1) +\n  coord_polar(\"y\") +\n  geom_text(\n    aes(label = label),\n    position = position_stack(vjust = 0.5),\n    color = \"white\",\n    size = 5) +\n  theme_void(base_family = \"mono\")+\n  theme(plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) + \n  labs(\n    title = \"Porcentaje de películas por género\",\n    subtitle = \"(protagonistas vengadores)\") +\n  scale_fill_manual(values = paleta_discreta)\n\np\n\n```\n\nPor último, en la siguiente gráfica se muestra el número de películas que tiene cada uno de los Vengadores. Cabe destacar el caso de Spider-Man el cual realmente tendría más películas; sin embargo, en este análisis solo usamos las más recientes que son las 3 protagonizadas por el actor Tom Holland y la de animación con Miles Morales.\n\n```{r}\n\np <- ggplot(pelicula_propia %>% filter(!is.na(movie)), aes(x = Alias)) +\n  geom_bar(fill = \"#ff721a\") +\n  labs(\n    title = \"Número de películas por personaje\",\n    x = \"Personajes\",\n    y = \"Número de películas\") +\n  coord_flip() +\n  geom_bar(aes(forcats::fct_rev(forcats::fct_infreq(Alias))),\n         fill = \"#ff721a\") +\n  theme_minimal(base_family = \"mono\")+\n  theme (plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\"))\n\np\n\n\n```\n\n------------------------------------------------------------------------\n\n### Segundo gráfico. Marvel y la taquilla\n\nA continuación, vamos a construir un gráfico circular para ver qué películas han tenido una mayor recaudación.\n\n```{r}\n#- segundo gráfico\n\nrecaudacion <- df_movies %>%\n  select(movie, `worldwide gross ($m)`) %>%\n  filter(!is.na(`worldwide gross ($m)`)) %>%\n  mutate(\n    id = row_number(),\n    value = `worldwide gross ($m)`,\n    individual = movie)\n\nnumber_of_bar <- nrow(recaudacion)\n\nangle <- 90 - 360 * (recaudacion$id - 0.5) / number_of_bar\n\nrecaudacion$hjust <- ifelse(angle < -90, 1, 0)\nrecaudacion$angle <- ifelse(angle < -90, angle + 180, angle)\n\n\np <- ggplot(recaudacion, aes(x = as.factor(id), y = value)) +\n    geom_bar(stat = \"identity\", fill = alpha(\"#2B5C8A\", 0.9)) +\n    ylim(-max(recaudacion$value) * 0.25, max(recaudacion$value) * 1.1) +\n    theme_minimal(base_family = \"mono\") +\n    theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    panel.grid = element_blank(),\n    plot.margin = unit(rep(1, 4), \"cm\")) +\n   coord_polar(start = 0) +\n  geom_text(\n    data = recaudacion,\n    aes(\n      x = id,\n      y = value + max(recaudacion$value) * 0.05,\n      label = individual,\n      hjust = hjust),\n    angle = recaudacion$angle,\n    inherit.aes = FALSE,\n    size = 3,\n    alpha = 0.7)\n\np\n\n\n```\n\nA este gráfico, para hacer una mayor aproximación,lo acompañaremos con una tabla que muestre el top 5 películas más recaudadas.\n\n```{r}\ntop5recaudacion <- df_movies %>%\n  arrange(desc(`worldwide gross ($m)`)) %>%\n  slice_head(n = 5) %>%\n  rename(recaudacion_taquilla = `worldwide gross ($m)`) %>%\n  select(movie, recaudacion_taquilla)\n\n\ntop5rec_tabla<- top5recaudacion %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Recaudación mundial\",\n    subtitle = \"(en millones de dólares)\") %>%\n  cols_label(\n    movie = \"Película\",\n    recaudacion_taquilla = \"Recaudación\")%>%\n  fmt_currency(\n    columns = recaudacion_taquilla,\n    currency = \"USD\",\n    decimals = 0) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5rec_tabla\n```\n\nFinalmente, compararemos el top 5 películas más valoradas por la audiencia con las más valoradas por los críticos.\n\n```{r}\n\ntop5audiencia <- df_movies %>%\n  arrange(desc(`audience % score`)) %>%\n  slice_head(n = 5) %>%\n  rename(audiencia = `audience % score`) %>%\n  select(movie, audiencia)\n\ntop5aud_tabla<- top5audiencia %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Mejor valoradas por la audiencia\",\n    subtitle = \"(en porcentaje)\") %>%\n  cols_label(\n    movie = \"Película\",\n    audiencia = \"Porcentaje\") %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5aud_tabla\n\n```\n\n```{r}\ntop5criticos <- df_movies %>%\n  arrange(desc(`critics % score`)) %>%\n  slice_head(n = 5) %>%\n  rename(criticos = `critics % score`) %>%\n  select(movie, criticos)\n\ntop5crit_tabla<- top5criticos %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Mejor valoradas por los críticos\",\n    subtitle = \"(en porcentaje)\") %>%\n  cols_label(\n    movie = \"Película\",\n    criticos = \"Porcentaje\") %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5crit_tabla\n```\n\nCon esta comparación podemos observar que las películas más aclamadas por la audiencia no coinciden con la valoración de los críticos a excepción de las dos películas de Spider-man lo cual, desde mi punto de vista, es un acierto puesto que a nivel de producción y trama son muy buenos largometrajes.\n\n------------------------------------------------------------------------\n\n### Otro gráfico. Apariciones en cómics y películas.\n\nEste  gráfico muestra el número de apariciones que han tenido los personajes. En este caso, hemos pedido los cinco con mayor frecuencia entre los cuales encontramos a Spider-Man y el Capitán América.\n\n```{r}\n#- tercer gráfico\n\napariciones <- df_personajes %>%\n   mutate(Appearances = as.numeric(Appearances),            \n         Appearances = if_else(`Name/Alias` == \"_Jr._(Earth-616)#\", 0, Appearances))\n\np <- apariciones  %>%\n  filter (Appearances >= 2000) %>%\n  slice_max(Appearances, n = 5) %>%\n  ggplot( aes(`Name/Alias`, Appearances, size = 2.5, color = `Name/Alias`)) +\n  geom_point() +\n  theme_gray(base_family = \"mono\") +\n  theme(legend.position = \"none\", \n        plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) +\n  scale_color_manual(values = paleta_discreta) + \n  labs(\n    title = \"Apariciones de personajes (aprox.)\") \n\nggplotly(p)\n\n```\n\n------------------------------------------------------------------------\n\n### ¿Cuál es la película más larga? ¿A qué fase pertenece?\nEn este apartado veremos las distintas duraciones que tienen las películas del MCU y qué fase es la que más películas tiene.\nAdemás, obtendremos cuál es la película más larga.\n\n```{r}\ndf_treemap <- df_fases %>%\n  filter(!is.na(runtime_min)) %>%   # quitamos NAs\n  mutate(\n    runtime_min = as.numeric(str_extract(runtime_min, \"^\\\\d+\")))\n\ntreemap(\n  df_treemap,\n  index = c(\"Phase\", \"Film\"),\n  vSize = \"runtime_min\",\n  vColor = \"runtime_min\",\n  type = \"value\",\n  palette = \"RdYlBu\",\n  fontsize.labels = c(16, 11),\n  fontcolor.labels = c(\"white\", \"black\")\n)\n\n```\nComo podemos observar, *Avengers: Endgame* es la más larga y pertenece a la fase 3.\n\n------------------------------------------------------------------------\n\n### Cartelera\n\nFinalmente, acabaremos este trabajo mostrando un gráfico en el que se muestre el número de películas que se han estrenado en los diferentes años.\n\n```{r}\n\ndf_plotline <- df_fases %>%\n  group_by(release_year) %>%\n  summarise(\n    n_peliculas = n(),\n    peliculas = paste(Film, collapse = \"\\n\")) %>%\n  ungroup() %>%\n  mutate(release_year = as.numeric(release_year)) \n\n# Gráfico con línea y puntos\np <- ggplot(df_plotline, aes(x = release_year, y = n_peliculas,\n                             text = paste0(\"Año: \", release_year,\n                                           \"<br>Películas:\\n\", peliculas))) +\n  geom_line(aes(group = 1), color = \"#8c0018\" , size = 1) + \n  geom_point(color = \"#720014\" , size = 4) +\n  theme_minimal(base_family = \"mono\") +\n  xlab(\"Año de estreno\") +\n  ylab(\"Cantidad de películas\") +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank())\n\n# Convertir a interactivo\nggplotly(p, tooltip = \"text\")\n\n\n```\n\n\n---\n\n<br>\n\nCon esto acabo mi trabajo para BigData ;)\n\n\n(**wakanda forever**)\n\n<br>\n\n------------------------------------------------------------------------\n\n<br>\n\n### Información sobre la sesión\n\nAbajo muestro mi entorno de trabajo y paquetes utilizados\n\n```{r}\n#| echo: false\nsessioninfo::session_info() %>% \n  details::details(summary = 'current session info') \n```\n","srcMarkdownNoYaml":"\n\n## Motivación\n\nEl Universo Cinematográfico de Marvel ha cambiado la industria del cine al popularizar el concepto de *multiverso* y *universo compartido*. No se trata solo de películas individuales, sino de una red interconectada de historias donde las acciones de una película afectan a las demás y todas estas están relacionadas.\n\nAsí pues, se ha convertido en una de las franquicias cinematográficas más taquillera de la historia, demostrando cómo una saga a largo plazo como lo es la *Saga del infinito* puede mantener el interés del público durante más de una década.\n\nPor ello, el trabajo presente tiene el objetivo de entender y averiguar las distintas características de las películas y personajes de Marvel desde la perspectiva de una fan. \n\n*Así que vamos allá!!*\n\n## Historia del MCU\n\nEn primer lugar, debemos saber que el UCM es una franquicia de medios centrada en una serie de películas de superhéroes producidas por Marvel Studios, basada en los personajes de Marvel Comics. La saga se divide en fases con dos arcos grandes: la Saga del Infinito y la Saga del Multiverso.\n\nNos centramos en sobre todo en la *Saga del Infinito* ya que es dónde se encuentra el grupo de *Avengers* el cual estaremos analizando durante todo el trabajo. Cabe mencionar que la película que pone final a la lucha de los vengadores está en la fase tres y es *Avengers: Endgame* (2019).\n\nPor otro lado, la primera película fue *Iron Man* en 2008 y fue dirigida por Jon Favreau. Esta película tiene mucha relevancia ya que fue el inicio de la presentación de héores individuales para posteriormente dar lugar a los Vengadores.\n\nAsí pues, en relación con *The Avengers* estos se reunen por primera vez en 2012, año de estreno de la película. El grupo original está formado por:\n\n- Iron Man.\n- Captain America.\n- Thor.\n- Hulk.\n- Black Widow.\n- Hawkeye.\n\nSin embargo, cabe mencionar que los personajes aparecidos en la última batalla y que, por tanto, vamos a considerar Vengadores y son los que vamos a analizar son los siguientes:\n\n- Trinidad de Vengadores: Iron Man, Capitán América y Thor.\n\n- Líderes de apoyo: Hulk, Hawkeye, War Machine, Ant-Man, Rocket y Nebula.\n\n- Héroes regresados por portales: Spider-Man, Black Panther, Shuri, Okoye, Falcon, Winter Soldier, Scarlet Witch, Doctor Strange, Wong y Wasp.\n\n- Guardianes de la Galaxia: Star-Lord, Drax, Mantis, Groot y Gamora (2014).\n\n- Refuerzos clave: Capitana Marvel, Valkyrie, Korg, Miek y Rescue (Pepper Potts).\n\n- Ejércitos aliados: Las Dora Milaje de Wakanda, los Hechiceros de las Artes Místicas, el ejército de Asgard y los Saqueadores.\n\n- Especial mención a Black Widow.\n\n## Introducción\n\nVamos a utilizar datos extraídos de Kaggle, los cuales podemos encontrar [aquí](https://www.kaggle.com/datasets/jainaru/marvel-movies-box-office-data?resource=download),  [aquí](https://www.kaggle.com/datasets/sahirmaharajj/the-avengers-dataset/data), \n[aquí](https://www.kaggle.com/datasets/dalepeh/mcu-movies-dataset) y\n[aquí](https://www.kaggle.com/datasets/jonbown/marvel-screen-time),\n\n\nA continuación, explicaremos un poco nuestra elección de datos:\n\nPor un lado, encontramos dfs en los que solo tenemos las películas del MCU y sus distintas variables con las que realizaremos el trabajo como son: las fases, la recaudación, las valoraciones, los años de estreno, los directores ... Además, tenemos un df con la duración en minutos de las películas.\n\nPor otro lado, hemos cargado dfs con los personajes tanto del MCU como de los cómics para poder trabajar con el global y solo con los Vengadores.\n\nLos datos se pueden cargar en la memoria de de R/RStudio de esta forma:\n\n```{r}\n#Importación de películas\n\nmy_ruta <- \"./data/marvel_movies.csv\"\n\ndf_movies <- rio::import(my_ruta)\n\nnames (df_movies)\n\nmy_ruta_fases <- \"./data/box_office.csv\"\n\ndf_fases <- rio::import(my_ruta_fases)\n\nmy_ruta_duracion <- \"./data/movie_times.csv\"\n\ndf_duracion <- rio::import(my_ruta_duracion)\n\n#- A continuación, para obtener los datos sobre los personajes podemos hacerlo de dos formas:\n\nmy_ruta_personajes <- \"./data/avengers.csv\" #- En este caso, creamos ruta relativa e importamos\n\ndf_personajes <- rio::import(my_ruta_personajes)\n\n#install.packages(\"fivethirtyeight\") ---- En este otro, instalamos el paquete que contiene a los personajes \n#library(fivethirtyeight)\n#df_personajes <- avengers ---- asociamos el nombre que queremos.install.packages(\"fivethirtyeight\")\n\nmy_ruta_fases <- \"./data/box_office.csv\"\n\ndf_fases <- rio::import(my_ruta_fases)\n\nmy_ruta_total_personajes <- \"./data/marvel_wikia_data.csv\"\n\ndf_total_personajes <- rio::import(my_ruta_total_personajes)\n\n```\n\nEl primer dataset contiene observaciones sobre un conjunto de `r nrow(df_movies)` películas de Marvel. Hay `r ncol(df_movies)` variables. El segundo dataset contiente observaciones sobre un conjunto `r nrow(df_personajes)` personajes de cómics. Hay `r ncol(df_personajes)` variables. \n\nCabe destacar que los datasets escogidos solo llegan hasta 2023 por lo que el análisis no incluirá los cambios que han habido de vengadores o algunas de las nuevas incorporaciones más recientes ni tendrá todas las películas de la fase 5 ni 6 (actual).\n\n---\n\n## Marvel Studios\n\nA continuación, podemos observar una imagen en la que se encuentran muchos de los principales personajes del Universo Cinematográfico de Marvel.\n\n```{r}\n#| echo: false\nmy_url <- \"https://images.alphacoders.com/100/1003204.jpg\"\n```\n\n![Marvel](https://images.alphacoders.com/100/1003204.jpg)\n\n```{r}\n#| echo: false\nlibrary(tidyverse)\nlibrary(ggimage)\nlibrary(magick)\n#| label: animacion-heroes\n#| message: false\n#| warning: false\n\niron_man <- image_read(\"./imagenes/iron_man.jpg\") %>% image_scale(\"700\")\nthor <- image_read(\"./imagenes/thor.webp\") %>% image_scale(\"700\")\nblack_panther <- image_read(\"./imagenes/black_panther.jpg\") %>% image_scale(\"700\")\nhawkeye <- image_read(\"./imagenes/hawkeye.jpg\") %>% image_scale(\"700\")\nblack_widow <- image_read(\"./imagenes/black_widow.jpg\") %>% image_scale(\"700\")\nspiderman <- image_read(\"./imagenes/spiderman.jpg\") %>% image_scale(\"700\")\ncaptain_america <- image_read(\"./imagenes/capi.jpg\") %>% image_scale(\"700\")\nhulk <- image_read(\"./imagenes/hulk.jpg\") %>% image_scale(\"700\")\ndr_strange <- image_read(\"./imagenes/dr_strange.jpg\") %>% image_scale(\"700\")\nguardianes <- image_read(\"./imagenes/guardianes.webp\") %>% image_scale(\"700\")\n\nheroes <- c(iron_man, thor, black_panther, hawkeye, black_widow, spiderman, captain_america, hulk, dr_strange, guardianes)\n\nanimacion <- image_animate(heroes, fps = 0.5)\nanimacion\n```\n\n------------------------------------------------------------------------\n\nComo bien sabemos el MCU es mucho más extenso ya que en los cómics hay muchos más personajes de los que han llegado a salir en la saga de *Avengers*; por ello, en el margen vamos a poner una foto con muchos más héroes y heroínas:\n\n::: column-margin\n![](./imagenes/universo_marvel.jpg){fig-align=\"center\"}\n:::\n\n------------------------------------------------------------------------\n\n\n\n## Algunos gráficos\n\nBueno pues vamos a hacer algún gráfico, pero claro antes he de cargar los paquetes.\n\n```{r}\n#| eval: true\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(forcats)\nlibrary(gt)\nlibrary(plotly)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary (treemap) #install.packages (\"treemap\")\nlibrary(ggimage)\n\n```\n\nPor otro lado, vamos a establecer la paleta que pondremos en nuestros gráficos.\n\n```{r setup}\n#Configuración de paleta\n\nlibrary(paletteer)\n\npaleta_discreta <- paletteer_c( \"ggthemes::Orange-Blue-White Diverging\", 6)\n\nscale_fill_default <- function(...) {\n  scale_fill_gradientn(colors = mi_paleta, ...)\n}\n\nscale_color_default <- function(...) {\n  scale_color_gradientn(colors = mi_paleta, ...)\n}\n\n\n```\n\n\nUn paso previo también es arreglar los datos. Para ello, en primer lugar, vamos a quitar aquellas columnas que no necesitamos o añadir las que nos hagan falta.\n\n```{r}\n#- En el df de películas no vamos a quitar ninguna columna; sin embargo, vamos a añadir una con el protagonista de cada película.\ndf_movies <- df_movies %>%\n  mutate (protagonista = case_when(\n    grepl(\"Iron\", movie) ~ \"Iron Man\",\n    grepl(\"America\", movie) ~ \"Captain America\",\n    grepl(\"Thor\", movie) ~ \"Thor\",\n    grepl(\"Incredible Hulk\", movie) ~ \"Hulk\",\n    grepl(\"Widow\", movie) ~ \"Black Widow\",\n    grepl(\"Ant-Man\", movie) ~ \"Ant-Man\",\n    grepl(\"Spider-Man\", movie) ~ \"Spider-Man\",\n    grepl(\"Shang-Chi\", movie) ~ \"Shang-Chi\",\n    grepl(\"Deadpool\", movie) ~ \"Deadpool\",\n    grepl(\"Panther\", movie) ~ \"Black Panther\",\n    grepl(\"Strange\", movie) ~ \"Dr Strange\",\n  )) %>%\n  relocate (protagonista, .after = category)\n\n#- En este caso, vamos a juntar el df de duración con el dde fases; para ello, primeramente tenemos que cambiar algunos nombres de películas porque la forma en la que están escritos es diferente en cada df y no podemos juntarlos bien.\ndf_duracion <- df_duracion %>%\n  mutate(movie = case_when(\n    movie == \"Spider-Man: Far from Home\" ~ \"Spider-Man: Far From Home\",\n    movie == \"Shang-Chi\" ~ \"Shang-Chi and the Legend of the Ten Rings\",\n    TRUE ~ movie))\n  \ndf_fases <- df_fases %>%\n  select (Phase, Film, Year_Release, Director, movie_image) %>%\n  left_join (df_duracion, by = c(\"Film\" = \"movie\"))  #- Tener en cuenta que en df_duración solo hasta 2021, aparecerán 5 NAs.\n\n#- Por otra parte, en el df de personajes vamos a hacer algunas modificaciones. Comenzaremos quitando estas dos columnas que no nos hacen falta:\ndf_personajes <- df_personajes %>%\n  select (- V22, - Notes)\n\n#- A continuación, añadimos una nueva columna llamada \"Alias\" en las que pondremos los nombres de superhéroe de cada personaje y la recolocaremos al lado de los Nombres/Alias originales:\n\ndf_personajes <- df_personajes %>%\n  filter(`Name/Alias` != \"Tony Masters\") %>% \n  mutate(Alias = case_when(\n    grepl(\"Tony\", `Name/Alias`) ~ \"Iron Man\",\n    grepl(\"Clinton Francis Barton\", `Name/Alias`) ~ \"Hawkeye\",\n    grepl(\"Rogers\", `Name/Alias`) ~ \"Captain America\",\n    grepl(\"Thor\", `Name/Alias`) ~ \"Thor\",\n    grepl(\"Banner\", `Name/Alias`) ~ \"Hulk\",\n    grepl(\"Romanova\", `Name/Alias`) ~ \"Black Widow\",\n    grepl(\"Scott Edward Harris Lang\", `Name/Alias`) ~ \"Ant-Man\",\n    grepl(\"Wanda Maximoff\", `Name/Alias`) ~ \"Scarlet Witch\",\n    grepl(\"Peter Benjamin Parker\", `Name/Alias`) ~ \"Spider-Man\",\n    grepl(\"Shang-Chi\", `Name/Alias`) ~ \"Shang-Chi\",\n    grepl(\"T'Challa\", `Name/Alias`) ~ \"Black Panther\",\n    grepl(\"Buchanan\", `Name/Alias`) ~ \"Bucky\",\n    grepl(\"Victor Shade \", `Name/Alias`) ~ \"Vision\",\n    grepl(\"Doctor Stephen Vincent Strange\", `Name/Alias`) ~ \"Dr Strange\",\n    TRUE ~ \"Other\")) %>%\n  relocate(Alias, .after = `Name/Alias`)\n\n#- También vamos a crear un nuevo df con los Vengadores para poder juntarlos con el df_movies\n\navengers <- df_personajes %>%\n  filter (Alias != \"Other\") %>%\n  select (URL, `Name/Alias`, Alias, Appearances, Gender)\n\n#- Finalmente, juntaremos el df de avengers con el de películas para tener observar las películas individuales que tienen algunos personajes:\n\npelicula_propia <- avengers %>%\n  left_join(df_movies, by = c(\"Alias\" = \"protagonista\")) %>%\n  select (`Name/Alias`,movie, Gender, Appearances, Alias, year)\n\n#- Finalmente, los df que usaremos son los siguientes:\n#- df_fases\n#- pelicula_propia\n#- df_movies\n#- df_total_personajes\n\n```\n\n------------------------------------------------------------------------\n\n### Primeros gráficos. Comparativa numérica\n\nEn este apartado, realizamos una comparación entre el número de héroes y heroínas y la cantidad de películas que están asociadas a cada uno.\n\nEn este primer gráfico, vamos a contrastar el número de personajes que hay en el MCU según su género para mostrar en una gráfica que el número de hombres es mayor al de mujeres, debido a que en un comienzo la mayoría de personajes que se escribían eran hombres.\n\n```{r}\n#- primer gráfico\n\nsexo <- df_total_personajes %>% \n  filter(SEX %in% c(\"Male Characters\", \"Female Characters\"))\n\np <- ggplot(data = sexo,\n  mapping = aes(x = SEX, fill = SEX)) +\n  geom_bar() +\n  labs(\n    title = \"Comparativa de sexo entre superhéroes\",\n    x = \"Sexo\",\n    y = \"Número de superhéroes\") +\n  theme_minimal(base_family = \"mono\") +\n  theme(legend.position = \"none\",\n        plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) +  \n  scale_fill_manual(values = paleta_discreta)\n\np\n\n\n```\n\nTras esta imagen, vamos a comparar el porcentaje de películas individuales que tienen los hombres vs las mujeres dentro del equipo de Vengadores en un piechart. Como podemos comprobar, al haber más héroes, tanto en el equipo de Avengers como en general, el porcentaje de películas que van a estar protagonizadas por ellos es mucho mayor.\n\n```{r}\n\nporcentaje <- pelicula_propia %>%\n  filter(!is.na(movie)) %>%\n  count(Gender) %>%\n  mutate(\n    porcentaje = n / sum(n),\n    label = scales::percent(porcentaje, accuracy = 1))\n\np <- ggplot( porcentaje,\n  aes(x = \"\", y = n, fill = Gender)) +\n  geom_bar(stat = \"identity\", width = 1) +\n  coord_polar(\"y\") +\n  geom_text(\n    aes(label = label),\n    position = position_stack(vjust = 0.5),\n    color = \"white\",\n    size = 5) +\n  theme_void(base_family = \"mono\")+\n  theme(plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) + \n  labs(\n    title = \"Porcentaje de películas por género\",\n    subtitle = \"(protagonistas vengadores)\") +\n  scale_fill_manual(values = paleta_discreta)\n\np\n\n```\n\nPor último, en la siguiente gráfica se muestra el número de películas que tiene cada uno de los Vengadores. Cabe destacar el caso de Spider-Man el cual realmente tendría más películas; sin embargo, en este análisis solo usamos las más recientes que son las 3 protagonizadas por el actor Tom Holland y la de animación con Miles Morales.\n\n```{r}\n\np <- ggplot(pelicula_propia %>% filter(!is.na(movie)), aes(x = Alias)) +\n  geom_bar(fill = \"#ff721a\") +\n  labs(\n    title = \"Número de películas por personaje\",\n    x = \"Personajes\",\n    y = \"Número de películas\") +\n  coord_flip() +\n  geom_bar(aes(forcats::fct_rev(forcats::fct_infreq(Alias))),\n         fill = \"#ff721a\") +\n  theme_minimal(base_family = \"mono\")+\n  theme (plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\"))\n\np\n\n\n```\n\n------------------------------------------------------------------------\n\n### Segundo gráfico. Marvel y la taquilla\n\nA continuación, vamos a construir un gráfico circular para ver qué películas han tenido una mayor recaudación.\n\n```{r}\n#- segundo gráfico\n\nrecaudacion <- df_movies %>%\n  select(movie, `worldwide gross ($m)`) %>%\n  filter(!is.na(`worldwide gross ($m)`)) %>%\n  mutate(\n    id = row_number(),\n    value = `worldwide gross ($m)`,\n    individual = movie)\n\nnumber_of_bar <- nrow(recaudacion)\n\nangle <- 90 - 360 * (recaudacion$id - 0.5) / number_of_bar\n\nrecaudacion$hjust <- ifelse(angle < -90, 1, 0)\nrecaudacion$angle <- ifelse(angle < -90, angle + 180, angle)\n\n\np <- ggplot(recaudacion, aes(x = as.factor(id), y = value)) +\n    geom_bar(stat = \"identity\", fill = alpha(\"#2B5C8A\", 0.9)) +\n    ylim(-max(recaudacion$value) * 0.25, max(recaudacion$value) * 1.1) +\n    theme_minimal(base_family = \"mono\") +\n    theme(\n    axis.text = element_blank(),\n    axis.title = element_blank(),\n    panel.grid = element_blank(),\n    plot.margin = unit(rep(1, 4), \"cm\")) +\n   coord_polar(start = 0) +\n  geom_text(\n    data = recaudacion,\n    aes(\n      x = id,\n      y = value + max(recaudacion$value) * 0.05,\n      label = individual,\n      hjust = hjust),\n    angle = recaudacion$angle,\n    inherit.aes = FALSE,\n    size = 3,\n    alpha = 0.7)\n\np\n\n\n```\n\nA este gráfico, para hacer una mayor aproximación,lo acompañaremos con una tabla que muestre el top 5 películas más recaudadas.\n\n```{r}\ntop5recaudacion <- df_movies %>%\n  arrange(desc(`worldwide gross ($m)`)) %>%\n  slice_head(n = 5) %>%\n  rename(recaudacion_taquilla = `worldwide gross ($m)`) %>%\n  select(movie, recaudacion_taquilla)\n\n\ntop5rec_tabla<- top5recaudacion %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Recaudación mundial\",\n    subtitle = \"(en millones de dólares)\") %>%\n  cols_label(\n    movie = \"Película\",\n    recaudacion_taquilla = \"Recaudación\")%>%\n  fmt_currency(\n    columns = recaudacion_taquilla,\n    currency = \"USD\",\n    decimals = 0) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5rec_tabla\n```\n\nFinalmente, compararemos el top 5 películas más valoradas por la audiencia con las más valoradas por los críticos.\n\n```{r}\n\ntop5audiencia <- df_movies %>%\n  arrange(desc(`audience % score`)) %>%\n  slice_head(n = 5) %>%\n  rename(audiencia = `audience % score`) %>%\n  select(movie, audiencia)\n\ntop5aud_tabla<- top5audiencia %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Mejor valoradas por la audiencia\",\n    subtitle = \"(en porcentaje)\") %>%\n  cols_label(\n    movie = \"Película\",\n    audiencia = \"Porcentaje\") %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5aud_tabla\n\n```\n\n```{r}\ntop5criticos <- df_movies %>%\n  arrange(desc(`critics % score`)) %>%\n  slice_head(n = 5) %>%\n  rename(criticos = `critics % score`) %>%\n  select(movie, criticos)\n\ntop5crit_tabla<- top5criticos %>%\n  gt() %>%\n  tab_header(\n    title = \"Top 5 películas Marvel - Mejor valoradas por los críticos\",\n    subtitle = \"(en porcentaje)\") %>%\n  cols_label(\n    movie = \"Película\",\n    criticos = \"Porcentaje\") %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_body()) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_title(groups = c(\"title\", \"subtitle\"))) %>%\n  tab_style(\n    style = cell_text(font = \"mono\"),\n    locations = cells_column_labels()) %>%\n  tab_options(\n    table.background.color = \"#FFF6ED\")\n\ntop5crit_tabla\n```\n\nCon esta comparación podemos observar que las películas más aclamadas por la audiencia no coinciden con la valoración de los críticos a excepción de las dos películas de Spider-man lo cual, desde mi punto de vista, es un acierto puesto que a nivel de producción y trama son muy buenos largometrajes.\n\n------------------------------------------------------------------------\n\n### Otro gráfico. Apariciones en cómics y películas.\n\nEste  gráfico muestra el número de apariciones que han tenido los personajes. En este caso, hemos pedido los cinco con mayor frecuencia entre los cuales encontramos a Spider-Man y el Capitán América.\n\n```{r}\n#- tercer gráfico\n\napariciones <- df_personajes %>%\n   mutate(Appearances = as.numeric(Appearances),            \n         Appearances = if_else(`Name/Alias` == \"_Jr._(Earth-616)#\", 0, Appearances))\n\np <- apariciones  %>%\n  filter (Appearances >= 2000) %>%\n  slice_max(Appearances, n = 5) %>%\n  ggplot( aes(`Name/Alias`, Appearances, size = 2.5, color = `Name/Alias`)) +\n  geom_point() +\n  theme_gray(base_family = \"mono\") +\n  theme(legend.position = \"none\", \n        plot.title = element_text(size=15,\n                                   vjust=2,\n                                   face=\"bold\")) +\n  scale_color_manual(values = paleta_discreta) + \n  labs(\n    title = \"Apariciones de personajes (aprox.)\") \n\nggplotly(p)\n\n```\n\n------------------------------------------------------------------------\n\n### ¿Cuál es la película más larga? ¿A qué fase pertenece?\nEn este apartado veremos las distintas duraciones que tienen las películas del MCU y qué fase es la que más películas tiene.\nAdemás, obtendremos cuál es la película más larga.\n\n```{r}\ndf_treemap <- df_fases %>%\n  filter(!is.na(runtime_min)) %>%   # quitamos NAs\n  mutate(\n    runtime_min = as.numeric(str_extract(runtime_min, \"^\\\\d+\")))\n\ntreemap(\n  df_treemap,\n  index = c(\"Phase\", \"Film\"),\n  vSize = \"runtime_min\",\n  vColor = \"runtime_min\",\n  type = \"value\",\n  palette = \"RdYlBu\",\n  fontsize.labels = c(16, 11),\n  fontcolor.labels = c(\"white\", \"black\")\n)\n\n```\nComo podemos observar, *Avengers: Endgame* es la más larga y pertenece a la fase 3.\n\n------------------------------------------------------------------------\n\n### Cartelera\n\nFinalmente, acabaremos este trabajo mostrando un gráfico en el que se muestre el número de películas que se han estrenado en los diferentes años.\n\n```{r}\n\ndf_plotline <- df_fases %>%\n  group_by(release_year) %>%\n  summarise(\n    n_peliculas = n(),\n    peliculas = paste(Film, collapse = \"\\n\")) %>%\n  ungroup() %>%\n  mutate(release_year = as.numeric(release_year)) \n\n# Gráfico con línea y puntos\np <- ggplot(df_plotline, aes(x = release_year, y = n_peliculas,\n                             text = paste0(\"Año: \", release_year,\n                                           \"<br>Películas:\\n\", peliculas))) +\n  geom_line(aes(group = 1), color = \"#8c0018\" , size = 1) + \n  geom_point(color = \"#720014\" , size = 4) +\n  theme_minimal(base_family = \"mono\") +\n  xlab(\"Año de estreno\") +\n  ylab(\"Cantidad de películas\") +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank())\n\n# Convertir a interactivo\nggplotly(p, tooltip = \"text\")\n\n\n```\n\n\n---\n\n<br>\n\nCon esto acabo mi trabajo para BigData ;)\n\n\n(**wakanda forever**)\n\n<br>\n\n------------------------------------------------------------------------\n\n<br>\n\n### Información sobre la sesión\n\nAbajo muestro mi entorno de trabajo y paquetes utilizados\n\n```{r}\n#| echo: false\nsessioninfo::session_info() %>% \n  details::details(summary = 'current session info') \n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"png","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"wrap","code-link":true,"code-line-numbers":true,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","include-in-header":[{"text":"<link rel = \"shortcut icon\" href = \"imagenes/uv.jpeg\" />\n"}],"toc":true,"toc-depth":3,"css":["assets/styles.css"],"highlight-style":"a11y","output-file":"my_trabajo_BigData.html"},"language":{"toc-title-document":"Indice de contenidos","toc-title-website":"En esta página","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","other-links-title":"Otros Enlaces","code-links-title":"Enlaces de código","launch-dev-container-title":"Iniciar Dev Container","launch-binder-title":"Iniciar Binder","article-notebook-label":"Cuaderno de Artículo","notebook-preview-download":"Descargar Cuaderno","notebook-preview-download-src":"Descargar código fuente","notebook-preview-back":"Volver al Artículo","manuscript-meca-bundle":"Archivo MECA","section-title-abstract":"Resumen","section-title-appendices":"Apéndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilizar","section-title-copyright":"Derechos de autor","section-title-citation":"Cita","appendix-attribution-cite-as":"Por favor cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"Ver Licencia","title-block-author-single":"Autor","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliación","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de Publicación","title-block-modified":"Fecha de modificación","title-block-keywords":"Palabras clave","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precaución","code-summary":"Código","code-tools-menu-caption":"Código","code-tools-show-all-code":"Enseñar el código","code-tools-hide-all-code":"Esconder el código","code-tools-view-source":"Ver el código","code-tools-source-code":"Ejecutar el código","tools-share":"Compartir","tools-download":"Descargar","code-line":"Línea","code-lines":"Líneas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiada","repo-action-links-edit":"Editar esta página","repo-action-links-source":"Ver el código","repo-action-links-issue":"Informar de un problema","back-to-top":"Volver arriba","search-no-results-text":"Sin resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la busqueda","search-hide-matches-text":"Esconder resultados adicionales","search-more-match-text":"hay más resultados en este documento","search-more-matches-text":"más resultados en este documento","search-clear-button-title":"Borrar","search-text-placeholder":"","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar sección","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegación de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposición","crossref-cnj-title":"Conjetura","crossref-def-title":"Definición","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Capítulo","crossref-apx-prefix":"Apéndice","crossref-sec-prefix":"Sección","crossref-eq-prefix":"Ecuación","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Prueba","environment-remark-title":"Observación","environment-solution-title":"Solución","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Pre-seleccionado","listing-page-order-by-date-asc":"Menos reciente","listing-page-order-by-date-desc":"Más reciente","listing-page-order-by-number-desc":"Número de mayor a menor","listing-page-order-by-number-asc":"Número de menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"Título","listing-page-field-description":"Descripción","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre de Archivo","listing-page-field-filemodified":"Fecha de modificación","listing-page-field-subtitle":"Sub-título","listing-page-field-readingtime":"Tiempo para completar lectura","listing-page-field-wordcount":"Conteo de Palabras","listing-page-field-categories":"Categorías","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados","listing-page-words":"{0} palabras","listing-page-filter":"Filtro","draft":"Borrador"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.8.24","lightbox":true,"anchor-sections":true,"other-links":[{"text":"Web del curso","href":"https://perezp44.github.io/intro-ds-25-26-web/"},{"text":"Trabajos de mis compañeros","href":"https://perezp44.github.io/intro-ds-25-26-web/05-trabajos-estudiantes.html"},{"text":"Repo del trabajo","href":"https://github.com/araarcos/trabajo_BigData_individual"}],"toc-location":"right","toc-title":"Índice","crossref":{"fig-title":"Gráfico","tbl-title":"Tabla"},"fig-cap-location":"bottom","code-copy":true,"knitr":{"opts_chunk":{"collapse":true,"comment":"#>","fig.asp":"7/9","out.width":"95%","fig.align":"center","fig.show":"hold","R.options":"options(scipen = 999)"}},"editor_options":{"chunk_output_type":"console"},"license":"CC BY","page-layout":"full","theme":["journal"],"mainfont":"Lato","title":"MCU. Un análisis codificado","description":"Un recorrido por las películas y los personajes del Universo Cinematográfico de Marvel\n","author":[{"name":"Arantxa Anais Arcos Raimundo","affiliation":"Universitat de València","affiliation-url":"https://www.uv.es"}],"date":"2026-01-02","categories":["trabajo BigData","marvel","hérores","películas"],"image":"./imagenes/universo_marvel.jpg","title-block-banner":true,"title-block-banner-color":"EB1F48","smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}